# 第六章——Java面向对象程序设计

> @wtl
>
> 2019.09.29

*面向对象程序设计（Object Oriented Programming, OOP）是一种新的程序设计方法。通过面向对象编程，能创建更加可靠，更容易理解，更容易被复用的程序。Java是一种完全面向对象的程序设计语言。*

## 面向对象程序设计思想

### 面向对象的基本概念

1. 对象

   对象是现实世界中事物的抽象表示

2. 类

   类是具有相同或相似性质的对象的抽象

3. 封装性

   封装性是指将描述某种实体的数据和基于这些数据的操作集合到一起，形成一个封装体。在封装体类，数据受到保护，通过与外界的接口实现信息交流。。在面向对象程序设计中，对象是封装的最基本单位，封装防止了程序的相互依赖而带来的影响。

4. 继承性

5. 多态性

   多态性反映客观事物的动态特性（行为）可以作用于多种不同的其他客观事物（对象），而处理的方法和获得的结果不尽相同。

## 面向对象设计

面向对象程序设计借助特定的计算机语言（如Java）实现从现实世界问题域中的实物对象到计算机世界中的数字“对象”的映射表达，为了便于区分现实世界中的实物对象和计算机世界中的数字对象，人们常将前者称为“实物对象”或“实体”，后者则简称为“对象”。

![](D:\桌面\Java\Java\第六章——Java面向对象程序设计\实体，对象与类之间的关系.jpg)

## 类和对象

### 类的定义

在面向对象的程序设计中，类是对象的抽象与归纳。它是一种复杂的数据类型，**不但包含数据，而且还包含对数据进行操作的方法（Method）**。通常人们将类中的数据称为成员变量，而操作数据的方法称为成员方法，二者统称为类的成员。

Java类的定义包括类声明和类主体两个部分，格式如下

```java
<类声明>//定义该类的名称，访问权限，与其他类的关系以及实现的接口等
{
<类主体>//类主体定义该类的成员变量，构造方法和成员方法。其中构造方法的作用是在使用new关键字创建类的实例的时候被调用来对成员变量进行初始化
}
```

#### 1. 类的声明

格式如下

```
[<修饰符>] class <类名> [extends<父类名>][implements<接口名列表>]
```

注：

- class 是定义类的关键字

- <类名><父类名><接口名>都应该是合法的Java标识符

- 在类的声明中必须包括关键字class和自定义的类名
- 方括号[ ]中的内容为可选项

```java
class C_Date

class C_Thermometer

class C_Patient

class C_Doctor

public class chapter6_1 //public是一个修饰符，它是用来限定这个类可以被其他所有的类访问
```

一个Java源文件中可以声明多个类，但用public修饰的类最多只有一个，**而且其源程序名必须与该类名相同**，修饰符缺省时表示这个类只允许本类以及同一个包中的其他类访问。如C_Date、C_Thermometer、C_Patient等类的声明。用于类声明的修饰符除public外，还有abstract和final。

#### 2. 类主体

类主体是用`{}`将类的成员变量和方法封装在一起形成一个程序块。

基本结构

```java
{
<成员变量的声明>
<构造方法的声明与实现>
<成员方法的声明及实现>
}
```

```java
class C_Date{
	//定义成员变量
    private int year;
   	private int month=1;
    private int day = 1;
    //定义构造方法
    public C_Date(int y,int m,int d)
    {
        year = y;
        month =m;
        day = d;
    }
    //定义成员方法
    public void setDate(int year, int month,int day){
        this.year=year;
        this.month=month;
        this.day=day;
    }
}
```



### 成员变量

成员变量与普通变量（局部变量）不同，它的声明必须放在类主体中，不能放在方法体内。

格式如下

`[修饰符][static][final] 数据类型 成员变量名1[,成员变量2，…]`

- 方括号[ ]中的内容为可选项
- 修饰符的作用：限定成员变量的可访问权限，主要又public , private,  protected,  以及缺省等四种情况
- static用于声明静态成员变量，final用于声明常量

### 成员方法

Java中的成员方法类似于C语言中的函数，**是可以执行调用执行并返回值的，能实现特定功能的程序段**。

Java语言的成员方法被封装在类主体中，用来改变对象的状态，及与其它类的实例进行交互。

成员方法由方法声明和方法体两部分组成，格式如下：

```java
[修饰符][abstract][static][final]  返回值类型 方法名([参数列表])[throws 异常类]//方法声明
    //abstract:抽象方法；static：静态方法；final：最终方法
{
	方法体
}
```

`public static void main(String args[])`

- 一般情况下，成员方法执行后都会向调用者返回数据操作的结果，返回值的类型就是用于声明该成员方法返回的结果的数据类型。可以是基本数据类型，也可以是引用类型。若成员方法不返回任何值，则返回类型用void标记，不能缺省。
- 参数列表又叫形参表。形参表主要用于声明该成员方法在被调用时需要调用者提供的、与数据操作相关的**参数的个数与数据类型**
- 如果方法体的返回类型不是void，则方法体应该包含return语句，且每个return语句都必须带与返回值类型相容的表达式；反之，如果返回值是void，则方法体中既可以包含return语句，也可以不包含return语句，且每个return语句都不能带表达式

### 方法的重载

方法声明中方法名和形参表统称为方法签名。一个类内不能定义两个相同方法签名的方法，否则将会导致编译错误。但是，一个类内可以定义几个**方法名相同而形参不同的方法**，这种机制被称为方法重载。

Java中，方法的重载既可以是成员方法，也可以是构造方法。重载的多个方法之间必须能通过参数列表相区别，且满足以下两个条件

1. 参数列表必须不同
2. 返回值类型可以相同，也可以不同

例：Math.abs()方法声明有四种

```java
static int abs(int a)
static long abs(long a)
static float abs(float a)
static double abs(double a)
```

### 构造方法

类的定义只是完成了同类对象的属性和行为方法的抽象描述，相当于对象的模板，而实际数据的处理却是由对象在其活动过程中完成的。在Java语言中，由一个类可以创建多个对象，这个过程称为对象的实例化。对象的实例化将自动从系统中获取包括对象成员变量在内对象活动所需的内存空间，并完成**对象及其成员变量的初始化**。这种自动初始化工作是通过调用类中一种特殊的方法来完成的，即类的构造方法（Constructor），又称构造器或者构造函数。其声明格式如下：

```java
[<修饰符>]<类名称>(<参数列表>)
{
    初始化的程序代码块
}
```

- 与成员方法不同，构造方法没有返回值类型，且只能通过new运算符调用
- 构造方法的修饰符一般采用public，以便于在其他位置根据需要实例化该类的对象

![](D:\桌面\Java\Java\第六章——Java面向对象程序设计\Java变量的默认初始值.jpg)

```java
public C_Date()//构造方法（无参数）
public C_Date(int y,int m,int d);//构造方法重载
```

其中date参数可以使用`new C_Date(year,month,day)`的形式完成实参的实例化。

### this引用

在Java类的方法体内，允许局部变量于类的成员变量同名。为了在方法体内区分成员变量于局部变量，Java提供了关键字this来表示指向当前对象的一个引用型变量。语法格式如下：

```java
this.成员变量
this.成员方法([参数列表])
```

注：在构造方法中，用this（）调用已声明的构方法时，必须放在第一行。

### 对象的创建与使用

#### 对象的创建

创建对象时，一般先定义一个对象变量，再用new运算符实例化一个对象，并把实例化对象的引用赋给对象变量。

创建格式如下：

`类名 对象名;//声明对象变量`

`对象名 = new 类名([实参列表]);//实例化对象`

例如

```java
C_Date aday;
aday = new C_Date;
//或者
类名 对象名 = new 类名([实参列表]);//声明对象变量的同时初始化对象
//如：
C_Date aday = new C_Date();
```

####  对象的使用

对象名获得一个对象实例后，在程序中就可以直接引用对象中的成员变量，调用成员方法，语法格式如下：

```java
对象名.成员变量
对象名.成员方法([实参列表])
//例如
aday.year = 2009;
aday.setDate(2009,10,29);
```

其中，对象名与成员变量或者成员方法之间使用点运算符“.”分隔。方法调用时给出的参数称为实参。实参可以是常量、变量、表达式或方法的调用，实参的个数与数据类型及排列次序一定要与类定义中该方法声明的形参保持一致（或者相容），且多个实参之间用逗号分隔。当调用方法时，系统按照实参与形参一一对应的关系将实参的值或引用传递给对应的形参。方法后的圆括号（）是必需的，即便该方法没有声明形式参数也不能缺省。

如果成员方法有返回值，则方法调用可以出现在表达式中，相当于它的返回值参加表达式运算。

如：`System. out. println("性别"+pa.getSex())`

Java语言中的类是引用数据类型，两个变量之间的赋值是引用赋值，对象变量也可被赋值为null。

### 类成员与实例成员

#### 实例成员变量和类成员变量

没有static修饰的成员变量称为实例成员变量。在创建对象实例时，系统会为每一个对象分配不同的内存单元，对象内部又会为自己的实例成员变量分配内存单元，也就是说不同的实例成员变量都有属于自己的内存单元。

对于类成员变量，系统在加载类时会为每一个类成员变量分配一个存储单元，所有该类的对象实例就同一个类成员变量都共享这个存储单元

例如：

​		`C_Patient p1 = new C_Patient("张鹰","男",new C_Date(1972,10,14));`

​		`C_Patient p2 = new C_Patient("李文","女",new C_Date(1965,2,10))`

#### 实例成员方法和类成员方法

 类的成员方法有两种：实例成员方法和类成员方法。

**没有static修饰的方法称为实例成员方法**。实例成员方法中既可以访问类成员变量和调用类成员方法，也可以访问实例成员变量和调用实例成员方法。实例成员方法的使用只能通过对象实例来调用。

类成员方法体中只能访问类成员变量或调用类成员方法，不能访问实例成员变量或调用实例成员方法。比如，常用的main方法是类成员方法，在他的方法体里面不能直接访问所在类的实例成员变量。但是类成员方法可以通过对象实例来调用，也可以通过类名来来调用。

```java
public class classA{
	public int i=1;	//实例变量
	public static int ii=10;//类变量
	public String Omethod(){	//实例方法
		return "Omethod";
	}
	public static String Smethod(){	//类方法
		return "Smethod";
	}
	public static void main(String[] args){	//main是类方法
		classA a = new classA();
		System. out. println(a.ii);	//类方法中允许访问类变量，允许
		System. out. println(classA.ii);//类方法中访问类变量，允许
		System. out. println(a.Smethod());//类方法中调用类方法，允许
		System. out. println(classA.Smethod());//类方法中调用类方法，允许
		
		
		//System. out. println(i);	//类方法中直接访问实例变量，不允许
		//System. out. println(Omethod());//类方法中直接调用实例方法，不允许
		
		System. out. println(a.i);//通过实例访问实例变量，允许
		System. out. println(a.Omethod());//通过实例调用实例方法，允许
		
	}
}
```

### 对象数组

Java语言中的数组属于引用数据类型，而数组元素既可以是基本数据类型，也可以是引用数据类型。若数组元素为引用数据类型，如字符串，数组或者类对象，则称该数组为对象数组。对象数组是Java语言用于保存多个同类对象引用的重要手段，其定义格式与普通数组类似，只是对象名替代数据类型而已。值得注意的是对象数组的元素并不是对象，而是指向对象的引用。

对象数组的初始化也需要使用new运算符获得数组元素的存储空间，用于存储数组元素（对象）的引用，对于每一个数组元素还需要使用new运算符实现对象的实例化。例如：

```java
C_Date dates[ ] = new C_Date[3];//定义并初始化对象数组
Date[0] = new C_Date;			//数组元素（对象）的实例化
Date[1] = new C_Date(1949,10,1);
Date[2] = new C_Date(2009,11,20);
```

![](D:\桌面\Java\Java\第六章——Java面向对象程序设计\对象数组的引用模型.jpg)

## 类的封装性

### 封装的概念

含义：

1. 将数据和对数据的操作组合起来构成类，类是一个不可分割的独立单位
2. 类中既要提供与外部联系的方法，同时又要尽可能隐藏类的实现细节和保护自身数据安全的安全性

### 访问权限修饰符

根据封装的原则，一般要求在类的设计中既能让使用者可以访问类中的部分方法，又不能直接访问类中的成员变量

| 权限修饰符     | 同一类 | 同一包 | 不同包的子类 | 所有类 |
| -------------- | :----: | :----: | :----------: | :----: |
| public         |   √    |   √    |      √       |   √    |
| protected      |   √    |   √    |      √       |        |
| 默认的（缺省） |   √    |   √    |              |        |
| private        |   √    |        |              |        |

### 类之间的组合关系

与类中基本数据类型的成员变量不同，一个类组合中包含的其它类的对象需要使用new运算符显式创建，编译器不会自动完成这个操作，这也是为了避免一些不必要的资源开销

## 类的继承性

### 继承的概念

继承性在父类和子类之间建立起了联系，子类自动拥有父类的全部成员，包括成员变量和成员方法，从而使父类成员得以传承和延续。子类可以更改父类的成员，使之适应或满足新的需求；子类也可以增加属于自己的新的成员。但是子类不能删除父类的成员。

Java中是单重继承。即一子一父，一父可多子。

基本原则：

1. 子类可以继承父类的实例成员变量和类成员变量
2. 子类可以继承父类的实例成员方法和类成员方法
3. 子类不能继承父类的构造方法，因为父类的构造方法创建的是父类的对象，子类必须声明自己的构造方法，创建自己的对象
4. 子类可以增加自己的成员变量与成员方法。如果子类声明了和父类同名的成员，则子类的成员隐藏了父类的成员。
5. 子类不能删除父类成员，但可以重新定义父类成员
6. 子类能够继承父类的析构方法

### 子类的定义

在类的声明中，通过使用关键字extends来定义一个类的子类。声明格式如下：

```java
[<修饰符>] class <子类名> extends <父类名> [implements<接口名>]
```

例如：

```java
class C_Surgen extends C_Doctor
{
	……
}
```

#### 子类与父类之间的赋值相容性

“即是”性质：子类对象即是父类对象，父类对象不是它的子类对象。

使用对象运算符`instanceof`可以判定一个对象是否属于指定类及其子类如：

```java
//C_Surgen是C_Doctor的子类
C_Doctor d1 = new C_Doctor("张鹰","男");
C_Surgen s1 = new C_Surgen("李文","女");
d1 instanceof C_Doctor; //true
s1 instanceof C_Surgen; //true
s1 instanceof C_Doctor; //true
d1 instanceof C_Surgen; //false 父类对象不是子类对象
```

继承性的即是性质表现为父类与子类之间具有赋值相容性，即父类对象名能够被赋值为子类对象的引用，反之则不行

例如

```java
C_Doctor d1 = new C_Surgen("李文","女");//赋值相容
C_Surgen s1 = new C_Doctor("张鹰","男");//错误，赋值不相容
```

#### 子类对象对父类对象的访问权限

1. 子类对父类中定义为private的私有成员没有访问权限
2. 子类可以访问父类中定义为public和protected的成员
3. 对父类中的缺省成员：同一包中的父类缺省成员可以访问，不同包的不能访问

#### 子类重定义从父类继承来的成员

1. 子类隐藏父类的成员变量
2. 子类覆盖父类的成员方法。注：此时，子类的方法声明必须与父类被覆盖方法的声明保持一致，且子类不能覆盖父类中声明为final的方法
3. 子类继承并重载父类的成员方法







































# 附：长案例程序6-1

**用面向对象的方法模拟医生为病人诊疗的过程**

本案例通过对病人的就诊模型的分析和简化，抽象出包括日期，体温计，病人以及医生等四个主要的类，并利用医生类的接诊、开处方、诊疗等实例成员方法将这些类联系起来，重现病人就诊时医生用体温计测量病人体温，给病人诊疗并开具处方的过程。

```java
//在面向对象的程序设计中，类是对象的抽象与归纳。它是一种复杂的数据类型，不但包含数据，而且还包含对数据进行操作的方法（Method）。
class C_Date	
{
	private int year;//年
	private int month = 1;//月
	private int day = 1;//天
	public C_Date()				//构造方法，无参数
	{
			year=1900;
	}
	public C_Date(int y,int m,int d);//构造方法的重载
	{
		year = y;
		month = m;
		day = d;
	}
	public void setDate(int year,int month,int day){	//设置日期的年-月-日
		this.year = year;
		this.month = month;
		this.day = day;
	}
	public int getYaar(){
		return year;
	}
	public int getMonth(){
		return month;
	}
	public int getDay(){
		return day;
	}
}
//温度计类
class C_Thermometer{
	private double vaule;	//温度计显示的值（摄氏度）
	public C_Thermometer(){	//构造方法
		vaule = 25.0;
	}
	public void reSet{	//温度计复位
		value = 30.0;
	}
	public double measure{	//测量体温
		value = 36 + (Math.random()*100%7);	//使用随机函数仿真被测量者体温值	
		return value;
	}
	public void measure(C_Patient pa){	//测量体温方法重载
		pa.setTemperature(measure());
	}
	public double getValue(){	
		return value;	//读取温度计值
	}
}
```







